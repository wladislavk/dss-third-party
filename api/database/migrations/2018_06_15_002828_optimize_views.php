<?php

use Illuminate\Support\Facades\Schema;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;

class OptimizeViews extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        DB::unprepared("ALTER TABLE `dental_summary` ADD KEY `location` (`location`);");
        DB::unprepared("ALTER TABLE `dental_summary` ADD KEY `titration_and_echovision` (`initial_device_titration_1`, `initial_device_titration_equal_h`, `initial_device_titration_equal_v`, `optimum_echovision_ver`, `optimum_echovision_hor`);");
        DB::unprepared("ALTER TABLE `dental_summary` ADD KEY `sti_o2_1` (`sti_o2_1`);");
        DB::unprepared("DROP VIEW IF EXISTS `dental_summary_pivot`;");
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        DB::unprepared("CREATE VIEW `dental_summary_pivot`  AS  select `inner_table`.`summaryid` AS `summaryid`,`inner_table`.`formid` AS `formid`,`inner_table`.`patientid` AS `patientid`,`inner_table`.`patient_name` AS `patient_name`,`inner_table`.`patient_dob` AS `patient_dob`,`inner_table`.`docpcp` AS `docpcp`,`inner_table`.`docsmd` AS `docsmd`,`inner_table`.`docomd1` AS `docomd1`,`inner_table`.`docomd2` AS `docomd2`,`inner_table`.`docdds` AS `docdds`,`inner_table`.`osite` AS `osite`,`inner_table`.`referral_source` AS `referral_source`,`inner_table`.`reason_seeking_tx` AS `reason_seeking_tx`,`inner_table`.`symptoms_osa` AS `symptoms_osa`,`inner_table`.`bed_time_partner` AS `bed_time_partner`,`inner_table`.`snoring` AS `snoring`,`inner_table`.`apnea` AS `apnea`,`inner_table`.`history_surgery` AS `history_surgery`,`inner_table`.`tried_cpap` AS `tried_cpap`,`inner_table`.`cpap_totalnights` AS `cpap_totalnights`,`inner_table`.`fna` AS `fna`,`inner_table`.`cpap_date` AS `cpap_date`,`inner_table`.`problem_cpap` AS `problem_cpap`,`inner_table`.`wearing_cpap` AS `wearing_cpap`,`inner_table`.`max_translation_from` AS `max_translation_from`,`inner_table`.`max_translation_to` AS `max_translation_to`,`inner_table`.`max_translation_equal` AS `max_translation_equal`,`inner_table`.`initial_device_titration_1` AS `initial_device_titration_1`,`inner_table`.`initial_device_titration_equal_h` AS `initial_device_titration_equal_h`,`inner_table`.`initial_device_titration_equal_v` AS `initial_device_titration_equal_v`,`inner_table`.`optimum_echovision_ver` AS `optimum_echovision_ver`,`inner_table`.`optimum_echovision_hor` AS `optimum_echovision_hor`,`inner_table`.`type_device` AS `type_device`,`inner_table`.`personal` AS `personal`,`inner_table`.`lab_name` AS `lab_name`,`inner_table`.`sti_test_1` AS `sti_test_1`,`inner_table`.`sti_test_2` AS `sti_test_2`,`inner_table`.`sti_test_3` AS `sti_test_3`,`inner_table`.`sti_test_4` AS `sti_test_4`,`inner_table`.`sti_date_1` AS `sti_date_1`,`inner_table`.`sti_date_2` AS `sti_date_2`,`inner_table`.`sti_date_3` AS `sti_date_3`,`inner_table`.`sti_date_4` AS `sti_date_4`,`inner_table`.`sti_ahi_1` AS `sti_ahi_1`,`inner_table`.`sti_ahi_2` AS `sti_ahi_2`,`inner_table`.`sti_ahi_3` AS `sti_ahi_3`,`inner_table`.`sti_ahi_4` AS `sti_ahi_4`,`inner_table`.`sti_rdi_1` AS `sti_rdi_1`,`inner_table`.`sti_rdi_2` AS `sti_rdi_2`,`inner_table`.`sti_rdi_3` AS `sti_rdi_3`,`inner_table`.`sti_rdi_4` AS `sti_rdi_4`,`inner_table`.`sti_supine_ahi_1` AS `sti_supine_ahi_1`,`inner_table`.`sti_supine_ahi_2` AS `sti_supine_ahi_2`,`inner_table`.`sti_supine_ahi_3` AS `sti_supine_ahi_3`,`inner_table`.`sti_supine_ahi_4` AS `sti_supine_ahi_4`,`inner_table`.`sti_supine_rdi_1` AS `sti_supine_rdi_1`,`inner_table`.`sti_supine_rdi_2` AS `sti_supine_rdi_2`,`inner_table`.`sti_supine_rdi_3` AS `sti_supine_rdi_3`,`inner_table`.`sti_supine_rdi_4` AS `sti_supine_rdi_4`,`inner_table`.`sti_lsat_1` AS `sti_lsat_1`,`inner_table`.`sti_lsat_2` AS `sti_lsat_2`,`inner_table`.`sti_lsat_3` AS `sti_lsat_3`,`inner_table`.`sti_lsat_4` AS `sti_lsat_4`,`inner_table`.`sti_titration_1` AS `sti_titration_1`,`inner_table`.`sti_titration_2` AS `sti_titration_2`,`inner_table`.`sti_titration_3` AS `sti_titration_3`,`inner_table`.`sti_titration_4` AS `sti_titration_4`,`inner_table`.`sti_cpap_p_1` AS `sti_cpap_p_1`,`inner_table`.`sti_cpap_p_2` AS `sti_cpap_p_2`,`inner_table`.`sti_cpap_p_3` AS `sti_cpap_p_3`,`inner_table`.`sti_cpap_p_4` AS `sti_cpap_p_4`,`inner_table`.`sti_apnea_1` AS `sti_apnea_1`,`inner_table`.`sti_apnea_2` AS `sti_apnea_2`,`inner_table`.`sti_apnea_3` AS `sti_apnea_3`,`inner_table`.`sti_apnea_4` AS `sti_apnea_4`,`inner_table`.`ep_date_1` AS `ep_date_1`,`inner_table`.`ep_date_2` AS `ep_date_2`,`inner_table`.`ep_date_3` AS `ep_date_3`,`inner_table`.`ep_date_4` AS `ep_date_4`,`inner_table`.`ep_date_5` AS `ep_date_5`,`inner_table`.`dset1` AS `dset1`,`inner_table`.`dset2` AS `dset2`,`inner_table`.`dset3` AS `dset3`,`inner_table`.`dset4` AS `dset4`,`inner_table`.`dset5` AS `dset5`,`inner_table`.`ep_e_1` AS `ep_e_1`,`inner_table`.`ep_e_2` AS `ep_e_2`,`inner_table`.`ep_e_3` AS `ep_e_3`,`inner_table`.`ep_e_4` AS `ep_e_4`,`inner_table`.`ep_e_5` AS `ep_e_5`,`inner_table`.`ep_s_1` AS `ep_s_1`,`inner_table`.`ep_s_2` AS `ep_s_2`,`inner_table`.`ep_s_3` AS `ep_s_3`,`inner_table`.`ep_s_4` AS `ep_s_4`,`inner_table`.`ep_s_5` AS `ep_s_5`,`inner_table`.`ep_w_1` AS `ep_w_1`,`inner_table`.`ep_w_2` AS `ep_w_2`,`inner_table`.`ep_w_3` AS `ep_w_3`,`inner_table`.`ep_w_4` AS `ep_w_4`,`inner_table`.`ep_w_5` AS `ep_w_5`,`inner_table`.`ep_a_1` AS `ep_a_1`,`inner_table`.`ep_a_2` AS `ep_a_2`,`inner_table`.`ep_a_3` AS `ep_a_3`,`inner_table`.`ep_a_4` AS `ep_a_4`,`inner_table`.`ep_a_5` AS `ep_a_5`,`inner_table`.`ep_el_1` AS `ep_el_1`,`inner_table`.`ep_el_2` AS `ep_el_2`,`inner_table`.`ep_el_3` AS `ep_el_3`,`inner_table`.`ep_el_4` AS `ep_el_4`,`inner_table`.`ep_el_5` AS `ep_el_5`,`inner_table`.`ep_h_1` AS `ep_h_1`,`inner_table`.`ep_h_2` AS `ep_h_2`,`inner_table`.`ep_h_3` AS `ep_h_3`,`inner_table`.`ep_h_4` AS `ep_h_4`,`inner_table`.`ep_h_5` AS `ep_h_5`,`inner_table`.`ep_r_1` AS `ep_r_1`,`inner_table`.`ep_r_2` AS `ep_r_2`,`inner_table`.`ep_r_3` AS `ep_r_3`,`inner_table`.`ep_r_4` AS `ep_r_4`,`inner_table`.`ep_r_5` AS `ep_r_5`,`inner_table`.`mini_consult` AS `mini_consult`,`inner_table`.`exam_impressions` AS `exam_impressions`,`inner_table`.`oa_soap` AS `oa_soap`,`inner_table`.`fm_blue` AS `fm_blue`,`inner_table`.`oa_check_1` AS `oa_check_1`,`inner_table`.`oa_check_2` AS `oa_check_2`,`inner_table`.`oa_check_3` AS `oa_check_3`,`inner_table`.`oa_check_4` AS `oa_check_4`,`inner_table`.`oa_check_5` AS `oa_check_5`,`inner_table`.`oa_check_6` AS `oa_check_6`,`inner_table`.`month_check_1` AS `month_check_1`,`inner_table`.`month_check_2` AS `month_check_2`,`inner_table`.`month_check_3` AS `month_check_3`,`inner_table`.`month_check_4` AS `month_check_4`,`inner_table`.`oa_psg` AS `oa_psg`,`inner_table`.`year_check_1` AS `year_check_1`,`inner_table`.`year_check_2` AS `year_check_2`,`inner_table`.`year_check_3` AS `year_check_3`,`inner_table`.`year_check_4` AS `year_check_4`,`inner_table`.`additional_notes` AS `additional_notes`,`inner_table`.`userid` AS `userid`,`inner_table`.`docid` AS `docid`,`inner_table`.`status` AS `status`,`inner_table`.`adddate` AS `adddate`,`inner_table`.`ip_address` AS `ip_address`,`inner_table`.`office` AS `office`,`inner_table`.`sleep_same_room` AS `sleep_same_room`,`inner_table`.`currently_wearing` AS `currently_wearing`,`inner_table`.`what_percentage` AS `what_percentage`,`inner_table`.`how_long` AS `how_long`,`inner_table`.`sleep_md` AS `sleep_md`,`inner_table`.`test_type_name` AS `test_type_name`,`inner_table`.`sti_sleep_efficiency_1` AS `sti_sleep_efficiency_1`,`inner_table`.`sti_sleep_efficiency_2` AS `sti_sleep_efficiency_2`,`inner_table`.`sti_sleep_efficiency_3` AS `sti_sleep_efficiency_3`,`inner_table`.`sti_sleep_efficiency_4` AS `sti_sleep_efficiency_4`,`inner_table`.`sti_rem_ahi_1` AS `sti_rem_ahi_1`,`inner_table`.`sti_rem_ahi_2` AS `sti_rem_ahi_2`,`inner_table`.`sti_rem_ahi_3` AS `sti_rem_ahi_3`,`inner_table`.`sti_rem_ahi_4` AS `sti_rem_ahi_4`,`inner_table`.`sti_o2_1` AS `sti_o2_1`,`inner_table`.`sti_o2_2` AS `sti_o2_2`,`inner_table`.`sti_o2_3` AS `sti_o2_3`,`inner_table`.`sti_o2_4` AS `sti_o2_4`,`inner_table`.`sti_other_1` AS `sti_other_1`,`inner_table`.`sti_other_2` AS `sti_other_2`,`inner_table`.`sti_other_3` AS `sti_other_3`,`inner_table`.`sti_other_4` AS `sti_other_4`,`inner_table`.`ep_ts_1` AS `ep_ts_1`,`inner_table`.`ep_ts_2` AS `ep_ts_2`,`inner_table`.`ep_ts_3` AS `ep_ts_3`,`inner_table`.`ep_ts_4` AS `ep_ts_4`,`inner_table`.`ep_ts_5` AS `ep_ts_5`,`inner_table`.`ep_tr_1` AS `ep_tr_1`,`inner_table`.`ep_tr_2` AS `ep_tr_2`,`inner_table`.`ep_tr_3` AS `ep_tr_3`,`inner_table`.`ep_tr_4` AS `ep_tr_4`,`inner_table`.`ep_tr_5` AS `ep_tr_5`,`inner_table`.`appt_notes_1` AS `appt_notes_1`,`inner_table`.`appt_notes_2` AS `appt_notes_2`,`inner_table`.`appt_notes_3` AS `appt_notes_3`,`inner_table`.`appt_notes_4` AS `appt_notes_4`,`inner_table`.`appt_notes_1p3` AS `appt_notes_1p3`,`inner_table`.`appt_notes_2p3` AS `appt_notes_2p3`,`inner_table`.`appt_notes_3p3` AS `appt_notes_3p3`,`inner_table`.`appt_notes_4p3` AS `appt_notes_4p3`,`inner_table`.`appt_notes_5p3` AS `appt_notes_5p3`,`inner_table`.`wapn1` AS `wapn1`,`inner_table`.`wapn2` AS `wapn2`,`inner_table`.`wapn3` AS `wapn3`,`inner_table`.`wapn4` AS `wapn4`,`inner_table`.`wapn5` AS `wapn5`,`inner_table`.`patientphoto` AS `patientphoto`,`inner_table`.`sleep_qual1` AS `sleep_qual1`,`inner_table`.`sleep_qual2` AS `sleep_qual2`,`inner_table`.`sleep_qual3` AS `sleep_qual3`,`inner_table`.`sleep_qual4` AS `sleep_qual4`,`inner_table`.`sleep_qual5` AS `sleep_qual5`,`inner_table`.`location` AS `location`,`inner_table`.`updated_at` AS `updated_at` from (`dental_summary` `inner_table` left join `dental_summary` `outer_table` on(((`inner_table`.`patientid` = `outer_table`.`patientid`) and (`inner_table`.`summaryid` < `outer_table`.`summaryid`)))) where isnull(`outer_table`.`patientid`);");
    }
}

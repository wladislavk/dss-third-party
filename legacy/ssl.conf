# This file is to track Apache configuration changes
# This file is NOT being used in the server
# This file only matches the main configuration lines from the original ssl.conf file in production

<VirtualHost _default_:443>
    DocumentRoot "/var/www/html/loader/public"
    ServerName www.dentalsleepsolutions.com
    ErrorLog "logs/loader-error.log"
    CustomLog "logs/loader-access.log" combined

    <Directory "/var/www/html/loader">
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        Order allow,deny
        Allow from all
    </Directory>

    <IfModule alias_module>
        AliasMatch "^/(.*\.)(css|js|map|json|bmp|cur|gif|jpg|jpeg|png|tif|swf|svg|eot|ttf|woff|xml)$" "/var/www/html/legacy/$1$2"

        # PDF files from /manage/letterpdfs/ will not be aliased
        # There will be a RewriteCond/RewriteRule counterpart in Loader
        AliasMatch "^/(?!manage/letterpdfs/)(.*\.)(pdf)$" "/var/www/html/legacy/$1$2"
    </IfModule>

    RewriteEngine on
    RewriteCond %{HTTP_HOST} !^www\.
    RewriteRule ^(.*)$ https://www.%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # Turn SSL off everything but /manage /reg /screener
    RewriteCond %{THE_REQUEST} !/manage
    RewriteCond %{THE_REQUEST} !/reg
    RewriteCond %{THE_REQUEST} !/screener
    RewriteCond %{THE_REQUEST} !/Scripts
    RewriteCond %{THE_REQUEST} !/js
    RewriteCond %{THE_REQUEST} !/assets
    RewriteRule ^(.*)$ http://www.dentalsleepsolutions.com/ [R=301,L]

    LogLevel warn

    SSLEngine on
    SSLProtocol all -SSLv2
    SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW

    SSLCertificateFile /etc/httpd/ssl/dentalsleepsolutions.com.crt
    SSLCertificateKeyFile /etc/httpd/ssl/dentalsleepsolutions.com.key
    SSLCertificateChainFile /etc/httpd/ssl/godaddy-bundle.crt

    <ifModule mod_gzip.c>
        mod_gzip_on Yes
        mod_gzip_dechunk Yes
        mod_gzip_item_include file .(html?|txt|css|js|php|pl)$
        mod_gzip_item_include mime ^text/.*
        mod_gzip_item_include mime ^application/x-javascript.*
        mod_gzip_item_exclude mime ^image/.*
        mod_gzip_item_exclude rspheader ^Content-Encoding:.*gzip.*
    </ifModule>

    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript

    FileETag MTime Size

    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresDefault "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType application/x-javascript "access plus 1 month"
        ExpiresByType text/javascript "access plus 1 month"
        ExpiresByType text/css "access plus 1 month"

      # Media files
        ExpiresByType audio/ogg "access plus 1 month"
        ExpiresByType image/bmp "access plus 1 month"
        ExpiresByType image/gif "access plus 1 month"
        ExpiresByType image/jpeg "access plus 1 month"
        ExpiresByType image/png "access plus 1 month"
        ExpiresByType image/svg+xml "access plus 1 month"
        ExpiresByType image/webp "access plus 1 month"
        ExpiresByType video/mp4 "access plus 1 month"
        ExpiresByType video/ogg "access plus 1 month"
        ExpiresByType video/webm "access plus 1 month"

        # Web fonts
        # Embedded OpenType (EOT)
        ExpiresByType application/vnd.ms-fontobject "access plus 1 month"
        ExpiresByType font/eot "access plus 1 month"

        # OpenType
        ExpiresByType font/opentype "access plus 1 month"

        # TrueType
        ExpiresByType application/x-font-ttf "access plus 1 month"

        # Web Open Font Format (WOFF) 1.0
        ExpiresByType application/font-woff "access plus 1 month"
        ExpiresByType application/x-font-woff "access plus 1 month"
        ExpiresByType font/woff "access plus 1 month"

        # Web Open Font Format (WOFF) 2.0
        ExpiresByType application/font-woff2 "access plus 1 month"
    </IfModule>
</VirtualHost>
<?
//session_start();
require_once('admin/includes/config.php');
include("includes/sescheck.php");
require_once('includes/constants.inc');
require_once('includes/authorization_functions.php');
require_once('includes/general_functions.php');
require_once('includes/notifications.php');
require_once('includes/patient_changes.php');
if($_SESSION['userid'] == '')
{
	?>
	<script type="text/javascript">
		alert("Members Area, Please Login");
		window.location = "login.php";
	</script>
	<?
}


//$page_sql = "select * from dental_pages where status=1 and  pageid='".s_for($_GET['pid'])."'";
//$page_my = mysql_query($page_sql);
//$page_myarray = mysql_fetch_array($page_my);

if($_SESSION['loginid'] <> '')
{
$cur_page_full =  $_SERVER['PHP_SELF']."?".$_SERVER['QUERY_STRING'];
$cur_ins_sql = "insert into dental_login_detail (loginid,userid,cur_page,adddate,ip_address) values('".$_SESSION['loginid']."','".$_SESSION['userid']."','".$cur_page_full."',now(),'".$_SERVER['REMOTE_ADDR']."')";
mysql_query($cur_ins_sql);
}

if(strpos($_SERVER['PHP_SELF'],'q_page') === false && strpos($_SERVER['PHP_SELF'],'ex_page') === false && strpos($_SERVER['PHP_SELF'],'q_sleep') === false && strpos($_SERVER['PHP_SELF'],'q_image') === false)
{
	$unload = 0 ;
}
else
{
	$unload = 1 ;
}

// Count letters
$docid = $_SESSION['docid'];
// $dental_letters_query = "SELECT COUNT(*) FROM dental_letters JOIN dental_patients ON dental_letters.patientid=dental_patients.patientid WHERE dental_letters.status = '0' AND dental_patients.docid = '".$docid."';";
$dental_letters_query = "SELECT UNIX_TIMESTAMP(dental_letters.generated_date) as generated_date FROM dental_letters LEFT JOIN dental_patients ON dental_letters.patientid=dental_patients.patientid WHERE dental_letters.status = '0' AND dental_letters.deleted = '0' AND dental_letters.docid = '".$docid."' ORDER BY generated_date ASC;";
$dental_letters_res = mysql_query($dental_letters_query);
$pending_letters = mysql_num_rows($dental_letters_res);
$generated_date = mysql_fetch_array($dental_letters_res);
$seconds_per_day = 86400;
if ($generated_date == 0) {
	$oldest_letter = 0;
} else {
	$oldest_letter = floor((time() - array_pop($generated_date)) / $seconds_per_day);
}

$dental_letters_query = "SELECT letterid FROM dental_letters 
				LEFT JOIN dental_patients ON dental_letters.patientid=dental_patients.patientid 
			WHERE (dental_letters.status = '1' OR dental_letters.delivered=1) AND
                                mailed_date IS NULL AND 
				dental_letters.deleted = '0' AND 
				dental_letters.docid = '".$docid."' 
				";
$dental_letters_res = mysql_query($dental_letters_query);
$unmailed_letters = mysql_num_rows($dental_letters_res);





// Count Claims
$claim_query = "SELECT * FROM dental_insurance WHERE docid = '".$docid."' AND (status='".DSS_CLAIM_PENDING."' OR status='".DSS_CLAIM_SEC_PENDING."')";
$claim_res = mysql_query($claim_query);
$num_pending_claims = mysql_num_rows($claim_res);

    $claim_query = "SELECT DISTINCT p.patientid FROM dental_ledger ledger
                         JOIN dental_transaction_code trxn_code ON trxn_code.transaction_code = ledger.transaction_code
                         JOIN dental_users user ON user.userid = ledger.docid
                         JOIN dental_patients p ON p.patientid = ledger.patientid
                  WHERE 
                         ledger.status = " . DSS_TRXN_PENDING ." 
                         AND ledger.docid = " . $_SESSION['docid'] . "
                         AND trxn_code.docid = " . $_SESSION['docid'] . "
                         AND trxn_code.type = " . DSS_TRXN_TYPE_MED;
    $claim_res = mysql_query($claim_query);
    $num_pending_claims = mysql_num_rows($claim_res);

// Count Preauths
$preauth_query = "SELECT * FROM dental_insurance_preauth WHERE doc_id = '".$docid."' AND status=".DSS_PREAUTH_COMPLETE." AND (viewed IS NULL OR viewed != 1);";
$preauth_res = mysql_query($preauth_query);
$num_preauth = mysql_num_rows($preauth_res);

$preauth_query = "SELECT * FROM dental_insurance_preauth WHERE doc_id = '".$docid."' AND status=".DSS_PREAUTH_PENDING.";";
$preauth_res = mysql_query($preauth_query);
$num_pending_preauth = mysql_num_rows($preauth_res);

$pc_query = "SELECT * FROM dental_patient_contacts pc inner join dental_patients p on p.patientid=pc.patientid WHERE p.docid = '".$docid."'";
$pc_res = mysql_query($pc_query);
$num_pc = mysql_num_rows($pc_res);

$pi_query = "SELECT * FROM dental_patient_insurance pi inner join dental_patients p on p.patientid=pi.patientid WHERE p.docid = '".$docid."'";
$pi_res = mysql_query($pi_query);
$num_pi = mysql_num_rows($pi_res);

$c_query = "SELECT * FROM dental_patients p2 inner join dental_patients p on p.patientid=p2.parent_patientid WHERE p.docid = '".$docid."'";
$c_res = mysql_query($c_query);
$num_c = mysql_num_rows($c_res);


$bounce_query = "SELECT * FROM dental_patients p WHERE p.email_bounce=1 AND p.docid = '".$docid."'";
$bounce_res = mysql_query($bounce_query);
$num_bounce = mysql_num_rows($bounce_res);

$unsigned_query = "select * from (select n.*, u.name signed_name, p.adddate as parent_adddate from
        (
        select * from dental_notes where status!=0 AND docid='".$_SESSION['docid']."' order by adddate desc
        ) as n
        LEFT JOIN dental_users u on u.userid=n.signed_id
        LEFT JOIN dental_notes p ON p.notesid = n.parentid
        group by n.parentid
        order by n.procedure_date DESC, n.adddate desc) as m
        where m.signed_on IS NULL OR m.signed_on = ''
        ";

$unsigned_res = mysql_query($unsigned_query);
$num_unsigned = mysql_num_rows($unsigned_res);

$preauth_query = "SELECT * FROM dental_insurance_preauth WHERE doc_id = '".$docid."' AND status=".DSS_PREAUTH_REJECTED." AND (viewed IS NULL OR viewed != 1);";
$preauth_res = mysql_query($preauth_query);
$num_rejected_preauth = mysql_num_rows($preauth_res);
?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?=$sitename;?></title>
<link href="css/admin.css" rel="stylesheet" type="text/css" />
<link href="css/task.css" rel="stylesheet" type="text/css" />
<link href="css/notifications.css" rel="stylesheet" type="text/css" />
<link href="css/search-hints.css" rel="stylesheet" type="text/css">
<link href="css/top.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="/manage/admin/script/jquery-1.6.2.min.js"></script>
  <script type="text/javascript" src="/manage/admin/script/jquery-ui-1.8.22.custom.min.js"></script>
    <script type="text/javascript" src="3rdParty/input_mask/jquery.maskedinput-1.3.min.js"></script>
    <script type="text/javascript" src="3rdParty/jquery.tablesorter.min.js"></script>
    <script type="text/javascript" src="js/masks.js"></script>
<script type="text/javascript" src="script/logout_timer.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>

<?php //<script type="text/javascript" src="js/p7tbmenu.js"></script> ?>
<script type="text/javascript" src="js/ddlevelsmenu.js">

/***********************************************
* All Levels Navigational Menu- (c) Dynamic Drive DHTML code library (http://www.dynamicdrive.com)
* This notice MUST stay intact for legal use
* Visit Dynamic Drive at http://www.dynamicdrive.com/ for full source code
***********************************************/

</script>

<script language="javascript" type="text/javascript" src="script/validation.js"></script>
<script language="javascript" type="text/javascript">
function display(){
    document.getElementById("future_dental_det").style.display = "block"; 
}
function hide(id){
    document.getElementById("future_dental_det").style.display = "none";
}
function displaysmoke(){
    document.getElementById("smoke").style.display = "block"; 
}
function hidesmoke(id){
    document.getElementById("smoke").style.display = "none";
}
</script>
<script language="javascript" type="text/javascript" src="script/hideshow.js"></script>

<script type="text/javascript" src="../../Scripts/sucker_tree.js"></script>
  <SCRIPT LANGUAGE="javascript">

function LinkUp() 
{
var number = document.DropDown.DDlinks.selectedIndex;
window.location.href = document.DropDown.DDlinks.options[number].value;
}
</SCRIPT>
<script type="text/javascript">
<!--
function toggleTB(what){
if(what.checked){document.patientfrm.premeddet.disabled=1}
else{document.patientfrm.premeddet.disabled=0}}
//-->
</script>

<script language="JavaScript">
var hasVB = false;

function jsConfirm(str)
{
    var results = (hasVB) ? vbConfirm(str) : confirm(str);
    document.getElementById('results').innerHTML = results;
}
</script>

<script language="VBScript">
hasVB = true
Function vbConfirm (str)
     return = msgbox(str, vbYesNo + vbQuestion)
     select case return
        case vbYes
            return = true
        case vbNo
            return = false
    end select
    vbConfirm = return
End Function
</script>
<script type="text/javascript" language="javascript">
function disableenable() {
  
  if(document.q_page1frm.bed_time_partner.options[document.q_page1frm.bed_time_partner.selectedIndex].value == 'No'){ 
  document.q_page1frm.quit_breathing.disabled = true;
  document.q_page1frm.sleep_same_room.disabled = true;
  }
  if(document.q_page1frm.bed_time_partner.options[document.q_page1frm.bed_time_partner.selectedIndex].value == 'Yes'){ 
  document.q_page1frm.quit_breathing.disabled = false;
  document.q_page1frm.sleep_same_room.disabled = false;
  }
  if(document.q_page1frm.bed_time_partner.options[document.q_page1frm.bed_time_partner.selectedIndex].value == 'Sometimes'){ 
  document.q_page1frm.quit_breathing.disabled = false;
  document.q_page1frm.sleep_same_room.disabled = false;
  }
  if(document.q_page1frm.bed_time_partner.options[document.q_page1frm.bed_time_partner.selectedIndex].value == ''){ 
  document.q_page1frm.quit_breathing.disabled = false;
  document.q_page1frm.sleep_same_room.disabled = false;
  }
  
}

function showMe(id) { // This gets executed when the user clicks on the checkbox
	var obj = document.getElementById(id);
if (obj.style.display=="none") { // if it is checked, make it visible, if not, hide it
	obj.style.display = "block";
} else {
	obj.style.display = "none";
}
}
function showMe2(id) { // This gets executed when the user clicks on the checkbox
	var obj = document.getElementById(id);
if (obj.style.display=="block") { // if it is checked, make it visible, if not, hide it
	obj.style.display = "none";
} else {
	obj.style.display = "block";
}
} 

</script>
  <!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>-->

<?php
  include('includes/calendarinc.php');
  if($_SERVER["SCRIPT_NAME"] == "/manage/q_image.php"){
  ?>
  <!-- Load the Cloud Zoom CSS file -->
  <link href="css/cloud-zoom.css" rel="stylesheet" type="text/css" />
  
  <!-- You can load the jQuery library from the Google Content Network.
  Probably better than from your own server. -->

  <!-- Load the Cloud Zoom JavaScript file -->
  <script type="text/JavaScript" src="js/cloud-zoom.1.0.2.min.js"></script>
  <?php
  }
?>
<script type="text/javascript">

function createCookie(name,value,days) {
              if (days) {
                  var date = new Date();
                  date.setTime(date.getTime()+(days*24*60*60*1000));
                  var expires = "; expires="+date.toGMTString();
              }
              else var expires = "";
              document.cookie = name+"="+value+expires+"; path=/";
          }

		
  function readCookie(name) {
              var nameEQ = name + "=";
              var ca = document.cookie.split(';');
              for(var i=0;i < ca.length;i++) {
                  var c = ca[i];
                  while (c.charAt(0)==' ') c = c.substring(1,c.length);
                  if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
              }
              return null;
  }
          
  function eraseCookie(name) {
              createCookie(name,"",-1);
  }
</script>

<link rel="stylesheet" href="css/letter-form.css" type="text/css" />
<link rel="stylesheet" href="css/form.css" type="text/css" />
<script type="text/javascript" src="script/wufoo.js"></script>

<?php if(isset($_GET['preview']) && $_GET['preview'] == '1'){
        
                      ?>
                      <script language=javascript>
        function check() {
           
            for (var i = 0; i < document.forms[0].elements.length; i++) {
               var element = document.forms[0].elements[i];
                switch (element.type) {
                    case 'text'://textbox type
                        document.forms[0].elements[i].readOnly = true;
                        break;
                    case 'select-one'://dropdown
                        document.forms[0].elements[i].readOnly = true;
                        document.forms[0].elements[i].disabled = true;
                        break;

                    case 'checkbox'://checkbox
                        document.forms[0].elements[i].disabled = true;
                        break;

                    case 'radio'://radiobutton
                        document.forms[0].elements[i].disabled = true;
                        break;

                    case 'button'://button
                        
                        document.forms[0].elements[i].disabled = true;

                        break;


                    case 'submit'://button
                        
                        document.forms[0].elements[i].disabled = true;

                        break;

                    case 'textarea'://textarea
                        document.forms[0].elements[i].readOnly = true;
                        break;
                }
            }
        }
    </script>  
                      <?php
        
                    }   ?>


<script type="text/javascript">

function focusIt(dtControl)
{
  var mytext = document.getElementById(dtControl);
  setTimeout("mytext.focus();",0);
}

function validateDate(dtControl)
{
    input = document.getElementById(dtControl)
    var validformat=/^\d{1,2}\/\d{1,2}\/\d{4}$/ //Basic check for format validity
    var returnval=false
    if (!validformat.test(input.value))
    alert('Invalid Day, Month, or Year range detected. Please correct. Must be MM/DD/YYYY');
    else{ //Detailed check for valid date ranges
    var monthfield=input.value.split("/")[0]
    var dayfield=input.value.split("/")[1]
    var yearfield=input.value.split("/")[2]
    var dayobj = new Date(yearfield, monthfield-1, dayfield)
    if ((dayobj.getMonth()+1!=monthfield)||(dayobj.getDate()!=dayfield)||(dayobj.getFullYear()!=yearfield))
    alert('Invalid Day, Month, or Year range detected. Please correct. Must be MM/DD/YYYY')
    else
    {
        returnval=true
    }
    }
    
    if (!validformat.test(input.value)){
    //document.getElementById(dtControl).focus;
    }
    //if (returnval==false){ setTimeout("input.focus();",0); }
    return returnval
    //focusIt(dtControl);
}

<?php //document.getElementById('flowsheet_page2').style.display='none'; ?>
</script>

 
<script type="text/javascript">
  function validate(){
    if(document.getElementById('service_date_ledger').value=""){
    alert('service date must be filled!');
    }  
  }           
 </script>

<?php if($_SERVER['PHP_SELF'] == "/manage/insurance.php"){?>

<script type="text/javascript">
function getKey(keyStroke) {
var t = window.event.srcElement.type;
var keyCode = (document.layers) ? keyStroke.which : event.keyCode;
var keyString = String.fromCharCode(keyCode).toLowerCase();
var leftArrowKey = 37;
var backSpaceKey = 8;
var escKey = 27;
if(t && (t =='text' || t =='textarea' || t =='file')){
//do not cancel the event
}else{
if( (keyCode == backSpaceKey){
return false;
}
}
}
</script> 

<?php } ?>


 <?php if($_SERVER['PHP_SELF'] == "/manage/manage_flowsheet3.php" || $_SERVER['PHP_SELF'] == "/manage/manage_flowsheet4.php"){
    $getstepqrysql = "SELECT * FROM `dental_flow_pg2` WHERE `patientid`='".$_GET['pid']."' LIMIT 1;";
	$getstepqry = mysql_query($getstepqrysql);
    $stepquery = mysql_fetch_array($getstepqry);
    $stepquery = array($stepquery[steparray]);
		if(mysql_num_rows($getstepqry) > 0){
    $step = explode(",",$stepquery['0']);
    ?>
      
    <?php
		if(isset($_GET['page']) && $_GET['page'] == 'page2'){
		?>
		<style>
      #flowsheet_page1{
        display:none;
      }
      #flowsheet_page2{
        display:block;
      }
      #flowsheet_page2btm{
        display:block;
      }		
		</style>
	
	<?php }else{ ?> 
	
	</script>
	<?php } ?>	
    <script type="text/javascript">	    	
   function hideallblocks(){
   	<?php if(!in_array("2", $step)){?>document.getElementById('consultrow').style.display = 'none';<?php } ?>
    <?php if(!in_array("3", $step)){?>document.getElementById('sleepstudyrow').style.display = 'none';<?php } ?>
    <?php if(!in_array("4", $step)){?>document.getElementById('impressionrow').style.display = 'none';<?php } ?>
    <?php if(!in_array("5", $step)){?>document.getElementById('delayingtreatmentrow').style.display = 'none';<?php } ?>
    <?php if(!in_array("6", $step)){?>document.getElementById('refusedtreatmentrow').style.display = 'none';<?php } ?>
    <?php if(!in_array("7", $step)){?>document.getElementById('devicedeliveryrow').style.display = 'none';<?php } ?>
    <?php if(!in_array("8", $step)){?>document.getElementById('checkuprow').style.display = 'none';<?php } ?>
    <?php if(!in_array("9", $step)){?>document.getElementById('patientnoncomprow').style.display = 'none';<?php } ?>
    <?php if(!in_array("10", $step)){?>document.getElementById('homesleeptestrow').style.display = 'none';<?php } ?>
    <?php if(!in_array("11", $step)){?>document.getElementById('starttreatmentrow').style.display = 'none';<?php } ?>
    <?php if(!in_array("12", $step)){?>document.getElementById('annualrecallrow').style.display = 'none';<?php } ?>
   } 
   </script>
    <?php
	
		}else{
		?>
		<script type="text/javascript">
   function hideallblocks(){
    document.getElementById('sleepstudyrow').style.display = 'none';
    document.getElementById('impressionrow').style.display = 'none';
    document.getElementById('delayingtreatmentrow').style.display = 'none';
    document.getElementById('refusedtreatmentrow').style.display = 'none';
    document.getElementById('devicedeliveryrow').style.display = 'none';
    document.getElementById('checkuprow').style.display = 'none';
    document.getElementById('patientnoncomprow').style.display = 'none';
    document.getElementById('starttreatmentrow').style.display = 'none';
    document.getElementById('annualrecallrow').style.display = 'none';
    document.getElementById('homesleeptestrow').style.display = 'none'; 
    document.getElementById('consultrow').style.display = 'none';
   } 
   </script>
		<?php

		}	
 } ?>

<script>
function popitup(url) {
	newwindow=window.open(url,'name','height=400,width=400');
	if (window.focus) {newwindow.focus()}
	return false;
}

</script> 

<script type="text/javascript">
	if(typeof String.prototype.trim !== 'function') {
  	String.prototype.trim = function() {
    	return this.replace(/^\s+|\s+$/g, ''); 
  	}
	}
	
	// Patient Search Suggestion Script
	var selection = 1;
	var selectedUrl = '';
	var searchVal = ""; // global variable to hold the last valid search string
	$(document).ready(function() {
		$('#patient_search').keyup(function(e) {
				var a = e.which; // ascii decimal value
				//var c = String.fromCharCode(a);
				var listSize = $('#patient_list li').size();
				var stringSize = $(this).val().length;
				if ($(this).val().trim() == "") {
					$('#search_hints').css('display', 'none');
					$('.json_patient').remove();
					$('.create_new').remove();
					$('.initial_list').css("display", "table-row");
				} else if ((stringSize > 1 || (listSize > 2 && stringSize > 1) || ($(this).val() == window.searchVal)) && ((a >= 39 && a <= 122 && a != 40) || a == 8)) { // (greater than apostrophe and less than z and not down arrow) or backspace
					$('.initial_list').css("display", "none");
					$('#search_hints').css("display", "inline");
					sendValue($('#patient_search').val());
					if ($(this).val() > 2) {
						window.searchVal = $(this).val().replace(/(\s+)?.$/, ""); // strip last character to match last positive result
					}
				}
		});
		$(document).keyup(function(e) {
			switch (e.which) {
				case 38:
					move_selection('up');
					break;
				case 40:
					move_selection('down');
					break;
				case 13:
				 	if($('#search_hints').css('display') == 'inline' || $('#search_hints').css('display') == 'block'){	
					  if (selectedUrl != '') {
						window.location = window.selectedUrl;
					  }
					}
					break;
			}
		});
		$('#patient_search').click(function() {
			if ($(this).val() == 'Patient Search') {
				$(this).val('');
			}
		});
		$('#patient_list > li').hover(function() {
			if($(this).data("pattype")!="no"){
			  $(this).css('cursor','pointer');
			}
			window.selection = $(this).data("number");
			set_selected(window.selection);
		}, function() {
			if($(this).data("pattype")!="no"){
			  $(this).css('cursor','auto');
			}
			$('#patient_list li').removeClass('list_hover');
			window.selectedUrl = '';
		});
		$('#patient_list > li').click(function() {
		    if($(this).data("pattype")=="new"){
			n = $('#patient_search').val();
			window.location = "add_patient.php?search="+n;
		    }else if($(this).data("pattype")=="no"){
			//do nothing
                    }else{
			if (selectedUrl != '') {
				window.location = window.selectedUrl;
			}
			$('#patient_search').val($(this).html());
			sendValue($(this).html());
		    }
		});
		$('*').click(function() {
			$('.search_hints').css('display', 'none');
		});
	});
	function sendValue(partial_name) {
		$.post(
		
		"list_patients.php",

		{ 
			"partial_name": partial_name 
		},

		function(data) {
			if (data.length == 0) {
				$('.json_patient').remove();
                                $('.create_new').remove();
				$('.no_matches').remove();
				//$('#search_hints').css('display', 'none');
                               var newLi = $('#patient_list .template').clone(true).removeClass('template').addClass('no_matches').data("pattype", "no");
                                        template_list_new(newLi, "No Matches")
                                                .appendTo('#patient_list')
                                                .fadeIn();
				var newLi = $('#patient_list .template').clone(true).removeClass('template').addClass('create_new').data("pattype", "new");
                                        template_list_new(newLi, "Add patient with this name&#8230;")
                                                .appendTo('#patient_list')
                                                .fadeIn();
			}else{
			if (data.error) {
				alert(data.error);
			} else {
				$('.json_patient').remove();
				$('.create_new').remove();
                               $('.no_matches').remove();
 
				for (i in data) {
					var newLi = $('#patient_list .template').clone(true).removeClass('template').addClass('json_patient').data("number", parseInt(i)+1).data("patientid", data[i].patientid).data("patient_info", data[i].patient_info);
					template_list(newLi, data[i])
						.appendTo('#patient_list')
						.fadeIn();
					<?php if ($_SERVER['PHP_SELF'] == "/manage/manage_patient.php") { ?>
					if (data[i].stat == "1") {
						var tr_class = "tr_active";
					} else {
						var tr_class = "tr_inactive";
					}
					var newRow = $('#patients .template').clone().removeClass('template').addClass('json_patient').addClass(tr_class);
					template_table(newRow, data[i])
						.appendTo('#patients')
						.fadeIn();
					<?php } ?>
				}
			   }
			}
		},

		"json"
		);
	}
	function move_selection(direction) {
		if ($('#patient_list > li.list_hover').size() == 0) {
			window.selection = 0;
		}
		if (direction == 'up' && window.selection != 0) {
			if (window.selection != 1) {
				window.selection--;
			}
		} else if (direction == 'down') {
			if (window.selection != ($("#patient_list li").size() -1)) {
				window.selection++;
			}
		}
		set_selected(window.selection);
	}
	function set_selected(menuitem) {
		$('#patient_list li').removeClass('list_hover');
		$('#patient_list li').eq(menuitem).addClass('list_hover');
		var pid = $('#patient_list li').eq(menuitem).data("patientid");
		var patient_info = $('#patient_list li').eq(menuitem).data("patient_info");
                    if($('#patient_list li').eq(menuitem).data("pattype")=="new"){
                        n = $('#patient_search').val();
                        window.selectedUrl = "add_patient.php?search="+n;
                    }else if($('#patient_list li').eq(menuitem).data("pattype")=="no"){
			window.selectedUrl = '';
                    }else{

		if (patient_info == 1) {
			window.selectedUrl = "/manage/manage_flowsheet3.php?pid=" + pid;
		} else {
			window.selectedUrl = "/manage/add_patient.php?pid=" + pid + "&ed=" + pid;
		}
		    }
	}
	function template_list(li, patient) {
		if(patient.middlename != null){
		var mid = patient.middlename
		}else{
			var mid = '';
		}
		li.html(patient.lastname + ", " + patient.firstname + " " + mid);
		return li;
	}
        function template_list_new(li, str) {
                li.html(str);
                return li;
        }

	function template_table(row, patient) {
		var pm = "";
		if (patient.premedcheck == "1") {
			var pm = "&nbsp;&nbsp;&nbsp;<font style=\"font-weight:bold; color:#FF0000;\">*Med";
		}
                if(patient.middlename != null){                        var mid = patient.middlename
                }else{
                        var mid = '';
                }
		if (patient.patient_info == 1) {
			row.find('.patient_name').html("<a href=\"add_patient.php?pid=" + patient.patientid + "&ed=" + patient.patientid + "\">" + patient.lastname + ", " + patient.firstname + " " + mid + "</a>" + pm);
			row.find('.flowsheet').html("<a href=\"manage_flowsheet3.php?pid=" + patient.patientid + "\">" + patient.fspage1_complete + "</a>");
			row.find('.next_visit').html("<a href=\"manage_flowsheet3.php?pid=" + patient.patientid + "&page=page2\">" + patient.next_visit + "</a>");
			row.find('.last_visit').html("<a href=\"manage_flowsheet3.php?pid=" + patient.patientid + "&page=page2\">" + patient.last_visit + "</a>");
			row.find('.last_treatment').html("<a href=\"manage_flowsheet3.php?pid=" + patient.patientid + "&page=page2\">" + patient.last_treatment + "</a>");
			row.find('.appliance').html("<a href=\"dss_summ.php?pid=" + patient.patientid + "\">" + patient.device + "</a>");
			row.find('.appliance_since').html("<a href=\"manage_flowsheet3.php?pid=" + patient.patientid + "&page=page2\">" + patient.delivery_date + "</a>");
			row.find('.vob').html("<a href=\"manage_insurance.php?pid=" + patient.patientid + "\">" + patient.vob + "</a>");
			row.find('.rxlomn').html("<a href=\"manage_flowsheet3.php?pid=" + patient.patientid + "\">" + patient.rxlomn + "</a>");
			row.find('.ledger').html("<a href=\"manage_ledger.php?pid=" + patient.patientid + "\">" + patient.ledger + "</a>");
		} else {
			row.html("<td><a href=\"add_patient.php?pid=" + patient.patientid + "&ed=" + patient.patientid + "\">" + patient.lastname + ", " + patient.firstname + " " + mid + "</a>" + pm+"</td><td colspan=\"9\" align=\"center\" class=\"pat_incomplete\">-- Patient Incomplete --</td>");
			/*
			row.find('.patient_name').html("<a href=\"add_patient.php?pid=" + patient.patientid + "&ed=" + patient.patientid + "\">" + patient.lastname + ", " + patient.firstname + " " + patient.middlename + "</a>" + pm);
			row.find('.flowsheet').html(patient.fspage1_complete);
			row.find('.next_visit').html(patient.next_visit);
			row.find('.last_visit').html(patient.last_visit);
			row.find('.last_treatment').html(patient.last_treatment);
			row.find('.appliance').html(patient.device);
			row.find('.appliance_since').html(patient.delivery_date);
			row.find('.vob').html(patient.vob);
			row.find('.ledger').html(patient.ledger)
			*/
		}
		return row;
	}
</script>

</head>
<body onload="disableBackspace();hideallblocks();document.getElementById('future_dental_det').style.display = 'none';parent.frames[0].document.getElementById('hideshow1').style.display='block';parent.frames[0].document.getElementById('hideshow2').style.display='none';parent.frames[0].document.getElementById('hideshow3').style.display='none';parent.frames[0].document.getElementById('hideshow4').style.display='none';parent.frames[0].document.getElementById('hideshow5').style.display='none';<?php if(isset($_GET['preview']) && $_GET['preview'] == '1'){?>check();<?php } if(isset($_GET['page']) && $_GET['page'] == 'page2'){ echo "document.getElementById('flowsheet_page1').style.display='none';";
 echo "document.getElementById('flowsheet_page2').style.display='block';";
}?>">
<?php
if(isset($_GET['page']) && $_GET['page'] == 'page2'){
?>
<style>
#flowsheet_page1{
display:none;
}
#flowsheet_page2{
display:block;
}
</style>

<?php
}else{
?>
<style>
#flowsheet_page1{
display:block;
}
#flowsheet_page2,#flowsheet_page2btm{
display:none;
}
</style>
 <?php /*<script type="text/javascript">
 document.getElementById('flowsheet_page1').style.display='none';
 document.getElementById('flowsheet_page2').style.display='block';
 </script>*/ ?>
 <?php
}
?>
<link rel="stylesheet" href="admin/popup/popup.css" type="text/css" media="screen" />

<?php if(isset($_GET['pid']) && $_GET['pid']!= ''){ ?> 
                    <?php
			$title = '';
                    $sql = "select * from dental_patients where docid='".$_SESSION['docid']."' AND patientid=".$_GET['pid'];
                    $my=mysql_query($sql) or die(mysql_error());
                    while($myarray = mysql_fetch_array($my))
                                {
			$premed = $myarray['premedcheck'];
                    if($premed){
                        $title .= "Pre-medication: " . $myarray['premed']."\n";
                    }
                    $sqlq3 = "select other_allergens, allergenscheck from dental_q_page3 WHERE patientid=".mysql_real_escape_string($_GET['pid']);
                    $myq3 = mysql_query($sqlq3);
                    $myq3array = mysql_fetch_assoc($myq3);
                    $allergen = $myq3array['allergenscheck'];
                    if($allergen){
                        $title .= "Allergens: " . $myq3array['other_allergens'];
                    }
                     $thename= $myarray['firstname']." ".$myarray['lastname'];
                    }
                    ?>
                    <?php } ?>


<script src="admin/popup/popup.js" type="text/javascript"></script>  
<table width="980" border="0" cellpadding="0" cellspacing="0" align="center">
<!-- Header and nav goes here -->
  <tr>
    <td colspan="2" align="right" > 
	
	</td>
  </tr>
  <tr>
	<td valign='top' height="400">
	<!-- <div style="float:right;margin-right:20px;margin-top:8px;width:120px;">
  
  <div style="text-align:center; float:left;width:50px; color:#00457c; padding-right:20px;"><a style="color:#00457c;text-decoration:none;" href="index.php" target="_self"><img border="0" src="images/homeIcon.png"><br />Home</a></div>
	
	
  <div style="text-align:center;float:right;width:50px;"><div><a style="color:#00457c;text-decoration:none;" href="logout.php" target="_self">Logout</div>
  <hr />
  <div style="margin-top:-2px;"><a style="color:#00457c;text-decoration:none;" href="search.php" target="_self">Search</a></div>
  </div>

  
  
  </div>-->
  <div class="suckertreemenu2">
     <ul id="topmenu">
       <li><a href="#">Manage Settings</a>
         <ul style="z-index:5001;margin-top:-20px;">
            <li><a class="menu_item" href="#">Directory</a></li>
                     <li><a class="submenu_item" href="manage_contact.php">Contacts</a></li>
                     <li><a class="submenu_item" href="manage_referredby.php">Referral List</a></li>
                     <li><a class="submenu_item" href="manage_sleeplab.php">Sleep Labs</a></li>
                     <li><a class="submenu_item" href="manage_fcontact.php">Corporate Contacts</a></li>
            <li><a class="menu_item" href="#">DSS Files</a></li>
                <?php 
			$s = "SELECT * FROM dental_document_category WHERE status=1 ORDER BY name ASC";
			$sq = mysql_query($s);
		        while($c = mysql_fetch_assoc($sq)){ ?>
				<li><a class="submenu_item" href="view_documents.php?cat=<?= $c['categoryid'];?>"><?= $c['name']; ?></a></li>

                       <?php }
		?>
            <li><a class="menu_item" href="#">Admin</a></li>
		     <li><a class="submenu_item" href="manage_profile.php">Profile</a></li>
                     <li><a class="submenu_item" href="manage_custom.php">Custom Text</a></li>
                     <?php if($_SESSION['userid']==$_SESSION['docid']){ ?>
                     <li><a class="submenu_item" href="manage_transaction_code.php">Transaction Code</a></li>
		     <?php } ?>
                     <li><a class="submenu_item" href="manage_staff.php">Staff</a></li>
		     <li><a class="submenu_item" href="manage_user_forms.php">Forms</a></li>
		     <li><a class="submenu_item" href="manage_manuals.php">Manuals</a></li>

              <li><a class="menu_item" href="pending_patient.php">Pending Patients</a></li>
              <li><a class="menu_item" href="export_md.php" onclick="return (prompt('Enter password')=='1234');">Export MD</a></li>
	  </ul>
	</li>
       <li><a href="logout.php">Sign Out</a></li>
      </ul>
  </div>

<script type="text/javascript">
$(document).ready(function(){
  $('#task_header').mouseover(function(){
    $('#task_list').show();
  });

  $('#task_menu').mouseleave(function(){
    $('#task_list').hide();
  })


});
</script>
<?php
$task_sql = "select dt.*, du.name, p.firstname, p.lastname from dental_task dt
        JOIN dental_users du ON dt.responsibleid=du.userid
        LEFT JOIN dental_patients p ON p.patientid=dt.patientid
   WHERE (dt.status = '0' OR
        dt.status IS NULL) AND
        dt.responsibleid='".mysql_real_escape_string($_SESSION['userid'])."'";
$task_q = mysql_query($task_sql);
$num_tasks = mysql_num_rows($task_q);
?>
 <div id="task_menu" class="task_menu" style="margin-top:8px;float:right">
<span id="task_header">My Tasks (<span id="task_count"><?= $num_tasks; ?></span>)</span>
<div id="task_list" style="border: solid 1px #000; position: absolute; z-index:20;background:#fff;padding:10px;display:none;">
<?php
$od_sql = $task_sql . " AND dt.due_date < CURDATE();";
$tod_sql = $task_sql . " AND dt.due_date = CURDATE();";
$tom_sql = $task_sql . " AND dt.due_date = DATE_ADD(CURDATE(), INTERVAL 1 DAY);";
if(date('N')==7){
  $this_sun = date('Y-m-d');
  $next_mon = date('Y-m-d',  strtotime("next Monday"));
  $next_sun = date('Y-m-d',  strtotime("next Sunday"));
}else{
  $this_sun = date('Y-m-d',  strtotime("next Sunday"));
  $next_mon = date('Y-m-d',  strtotime("next Monday"));
  $next_sun = date('Y-m-d',  strtotime("next Sunday + 1 week"));
}
$tw_sql = $task_sql . " AND dt.due_date BETWEEN DATE_ADD(CURDATE(), INTERVAL 2 DAY) AND '".$this_sun."'";
$nw_sql = $task_sql . " AND dt.due_date BETWEEN '".$next_mon."' AND '".$next_sun."'";
$lat_sql = $task_sql . " AND dt.due_date > '".$next_sun."' ORDER BY dt.due_date ASC";
$od_q = mysql_query($od_sql);
if(mysql_num_rows($od_q)>0){
?>
<h4 id="task_od_header" style="color:red;" class="task_od_header">Overdue</h4>
<ul id="task_od_list">
<?php
while($od_r = mysql_fetch_assoc($od_q)){
?><li class="task_item task_<?= $od_r['id']; ?>" style="clear:both;">
<div class="task_extra" id="task_extra_<?= $od_r['id']; ?>" >
  <a href="#" onclick="delete_task('<?= $od_r['id']; ?>')" class="task_delete"></a>
  <a href="#" onclick="loadPopup('add_task.php?id=<?= $od_r['id']; ?>')" class="task_edit">Edit</a>
</div>
<input type="checkbox" class="task_status" style="float:left;" value="<?= $od_r['id']; ?>" />
<div style="float:left; width:170px;"><?php echo $od_r['task']; ?>
<?php if($od_r['firstname']!='' && $od_r['lastname']!=''){
  echo ' (<a href="add_patient.php?ed='.$od_r['patientid'].'&preview=1&addtopat=1&pid='.$od_r['patientid'].'">'.$od_r['firstname'].' '. $od_r['lastname'].'</a>)';
} ?></div>
</li>
<?php
}
?>
</ul>
<?php
}

$tod_q = mysql_query($tod_sql);
if(mysql_num_rows($tod_q)>0){
?>
<h4 id="task_tod_header" class="task_tod_header">Today</h4>
<ul id="task_tod_list">
<?php
while($od_r = mysql_fetch_assoc($tod_q)){
?><li class="task_item task_<?= $od_r['id']; ?>" style="clear:both;">
<div class="task_extra" id="task_extra_<?= $od_r['id']; ?>" >
  <a href="#" onclick="delete_task('<?= $od_r['id']; ?>')" class="task_delete"></a>
  <a href="#" onclick="loadPopup('add_task.php?id=<?= $od_r['id']; ?>')" class="task_edit">Edit</a>
</div>
<input type="checkbox" class="task_status" style="float:left;" value="<?= $od_r['id']; ?>" />
<div style="float:left; width:170px;"><?php echo $od_r['task']; ?>
<?php if($od_r['firstname']!='' && $od_r['lastname']!=''){
  echo ' (<a href="add_patient.php?ed='.$od_r['patientid'].'&preview=1&addtopat=1&pid='.$od_r['patientid'].'">'.$od_r['firstname'].' '. $od_r['lastname'].'</a>)';
} ?></div>
</li>
<?php

}
?>
</ul>
<?php
}

$tom_q = mysql_query($tom_sql);
if(mysql_num_rows($tom_q)>0){
?>
<h4 id="task_tom_header" class="task_tom_header">Tomorrow</h4>
<ul id="task_tom_list">
<?php
while($od_r = mysql_fetch_assoc($tom_q)){
?><li class="task_item task_<?= $od_r['id']; ?>" style="clear:both;">
<div class="task_extra" id="task_extra_<?= $od_r['id']; ?>" >
  <a href="#" onclick="delete_task('<?= $od_r['id']; ?>')" class="task_delete"></a>
  <a href="#" onclick="loadPopup('add_task.php?id=<?= $od_r['id']; ?>')" class="task_edit">Edit</a>
</div>
<input type="checkbox" class="task_status" style="float:left;" value="<?= $od_r['id']; ?>" />
<div style="float:left; width:170px;"><?php echo $od_r['task']; ?>
<?php if($od_r['firstname']!='' && $od_r['lastname']!=''){
  echo ' (<a href="add_patient.php?ed='.$od_r['patientid'].'&preview=1&addtopat=1&pid='.$od_r['patientid'].'">'.$od_r['firstname'].' '. $od_r['lastname'].'</a>)';
} ?></div>
</li>
<?php
}
?>
</ul>
<?php } ?>

<?php
$tw_q = mysql_query($tw_sql);
if(mysql_num_rows($tw_q)>0){
?>
<h4 id="task_tw_header" class="task_tw_header">This Week</h4>
<ul id="task_tw_list">
<?php
while($od_r = mysql_fetch_assoc($tw_q)){
?><li class="task_item task_<?= $od_r['id']; ?>" style="clear:both;">
<div class="task_extra" id="task_extra_<?= $od_r['id']; ?>" >
  <a href="#" onclick="delete_task('<?= $od_r['id']; ?>')" class="task_delete"></a>
  <a href="#" onclick="loadPopup('add_task.php?id=<?= $od_r['id']; ?>')" class="task_edit">Edit</a>
</div>
<input type="checkbox" class="task_status" style="float:left;" value="<?= $od_r['id']; ?>" />
<div style="float:left; width:170px;"><?php echo $od_r['task']; ?>
<?php if($od_r['firstname']!='' && $od_r['lastname']!=''){
  echo ' (<a href="add_patient.php?ed='.$od_r['patientid'].'&preview=1&addtopat=1&pid='.$od_r['patientid'].'">'.$od_r['firstname'].' '. $od_r['lastname'].'</a>)';
} ?></div>
</li>
<?php
}
?>
</ul>
<?php } ?>

<?php
$nw_q = mysql_query($nw_sql);
if(mysql_num_rows($nw_q)>0){
?>
<h4 id="task_nw_header" class="task_nw_header">Next Week</h4>
<ul id="task_nw_list">
<?php
while($od_r = mysql_fetch_assoc($nw_q)){
?><li class="task_item task_<?= $od_r['id']; ?>" style="clear:both;">
<div class="task_extra" id="task_extra_<?= $od_r['id']; ?>" >
  <a href="#" onclick="delete_task('<?= $od_r['id']; ?>')" class="task_delete"></a>
  <a href="#" onclick="loadPopup('add_task.php?id=<?= $od_r['id']; ?>')" class="task_edit">Edit</a>
</div>
<input type="checkbox" class="task_status" style="float:left;" value="<?= $od_r['id']; ?>" />
<div style="float:left; width:170px;"><?php echo $od_r['task']; ?>
<?php if($od_r['firstname']!='' && $od_r['lastname']!=''){
  echo ' (<a href="add_patient.php?ed='.$od_r['patientid'].'&preview=1&addtopat=1&pid='.$od_r['patientid'].'">'.$od_r['firstname'].' '. $od_r['lastname'].'</a>)';
} ?></div>
</li>
<?php
}
?>
</ul>
<?php } ?>



<?php
$lat_q = mysql_query($lat_sql);
if(mysql_num_rows($lat_q)>0){
?>
<h4 id="task_lat_header" class="task_lat_header">Later</h4>
<ul id="task_lat_list">
<?php
while($od_r = mysql_fetch_assoc($lat_q)){
?><li class="task_item task_<?= $od_r['id']; ?>" style="clear:both;">
<div class="task_extra" id="task_extra_<?= $od_r['id']; ?>" >
  <a href="#" onclick="delete_task('<?= $od_r['id']; ?>')" class="task_delete"></a>
  <a href="#" onclick="loadPopup('add_task.php?id=<?= $od_r['id']; ?>')" class="task_edit">Edit</a>
</div>
<input type="checkbox" class="task_status" style="float:left;" value="<?= $od_r['id']; ?>" />
<div style="float:left; width:170px;">
<?= date('M d', strtotime($od_r['due_date'])); ?>
-
<?php echo $od_r['task']; ?>
<?php if($od_r['firstname']!='' && $od_r['lastname']!=''){
  echo ' (<a href="add_patient.php?ed='.$od_r['patientid'].'&preview=1&addtopat=1&pid='.$od_r['patientid'].'">'.$od_r['firstname'].' '. $od_r['lastname'].'</a>)';
} ?></div>
</li>
<?php
}
?>
</ul>
<?php } ?>


<?php
if(mysql_num_rows($od_q)==0 && mysql_num_rows($tod_q) == 0 && mysql_num_rows($tom_q) == 0){
}
?>
<br /><br />
<a href="manage_tasks.php" class="button" style="padding:2px 10px;">View All</a>
</div>
</div> 

<?php
if($_SESSION['docid']==$_SESSION['userid']){
  $course_sql = "SELECT use_course FROM dental_users WHERE userid='".mysql_real_escape_string($_SESSION['userid'])."'";
  $course_q = mysql_query($course_sql);
  $course_r = mysql_fetch_assoc($course_q);
  if($course_r['use_course']==1){
    ?><a style="display:block; margin-right:20px;  margin-top:8px; float:right;" href="course.php" target="_blank">Course</a><?php
  }
}else{
  $course_sql = "SELECT s.use_course, d.use_course_staff FROM dental_users s
		JOIN dental_users d ON d.userid = s.docid
		WHERE s.userid='".mysql_real_escape_string($_SESSION['userid'])."'";
  $course_q = mysql_query($course_sql);
  $course_r = mysql_fetch_assoc($course_q);
  if($course_r['use_course']==1 && $course_r['use_course_staff']==1){
    ?><a style="display:block; margin-right:20px;  margin-top:8px; float:right;" href="course.php" target="_blank">Course</a><?php
  }
}
?>


<a style="display:block; margin-right:20px;  margin-top:8px; float:right;" href="calendar.php">Scheduler</a>

 <script type="text/javascript" src="js/task.js"></script> 
 <script type="text/javascript" src="script/autocomplete.js"></script>
 
  <div style="height:89px; width:980px; background:url(images/dss_01.png) #0b5c82 no-repeat top left;">
     
    <div style="margin-top:10px; margin-left:20px; float:left;">
<a href="/manage" id="logo"></a>
    <!--<form name="form" action="search.php" method="get">-->
  <div id="patient_search_div">
  <input type="text" id="patient_search" value="Patient Search" name="q" autocomplete="off" />
  <!--<input type="submit" name="Submit" value="Patient Search By Last Name" />-->
	<br />
	<div id="search_hints"  class="search_hints" style="display:none;">
		<ul id="patient_list">
			<li class="template" style="display:none">Doe, John S</li>
		</ul>
	</div>
   </div> 

   <button onclick="window.location='add_patient.php'" style="margin-top:27px;">+ Add Patient</button>

   <button onclick="loadPopup('add_task.php<?= (isset($_GET['pid']))?'?pid='.$_GET['pid']:''; ?>')" style="margin-top:27px;">+ Add Task</button>
<!--</form>-->
    </div>
   <?php
     $logo_sql = "SELECT c.logo FROM companies c
			JOIN dental_user_company uc ON uc.companyid = c.id
			WHERE uc.userid='".$_SESSION['userid']."'";
     $logo_q = mysql_query($logo_sql);
     $logo_r = mysql_fetch_assoc($logo_q);
     if($logo_r['logo'] != ''){ ?>
   <div style="float:right;margin:13px 15px 0 0;"><img src="q_file/<?=$logo_r['logo']; ?>" /></div> 
     <?php } ?>
     <div style="clear:both;"></div>
  </div>
  
  <script type="text/javascript">

  function areyousure(tturl){
		window.location = tturl;
    /*var answer = confirm("Leave without saving?")
  	if (answer){
  		alert('Page not saved');
  		window.location = tturl;
  	}
  	else{
  			
  	}
		*/
  }
</script>
  <div style="background:url(images/dss_03.jpg) #0b5c82 repeat-y top left;width:100%;"><div style="width:98.6%; background:#00457c;margin:0 auto;">
  <?php if(isset($_GET['pid']) && $_GET['pid']!=''){ ?>
    <div id="patient_name_div" <?= (strlen($thename)>20)?'style="font-size:14px"':''; ?>><?= $thename; ?>
		<?php if($premed == 1 || $allergen == 1){
                    echo "<a href=\"q_page3.php?pid=".$_GET['pid']."\" title=\"".$title."\" style=\"font-weight:bold; font-size:18px; color:#FF0000;\">*Med</a>";
                    } ?>

<?php
$t_sql = "select dt.*, du.name, p.firstname, p.lastname from dental_task dt
        JOIN dental_users du ON dt.responsibleid=du.userid
        LEFT JOIN dental_patients p ON p.patientid=dt.patientid
   WHERE (dt.status = '0' OR
        dt.status IS NULL) AND
        (du.docid='".mysql_real_escape_string($_SESSION['docid'])."' OR du.userid='".mysql_real_escape_string($_SESSION['docid'])."') AND
 	dt.patientid='".mysql_real_escape_string($_GET['pid'])."'";
$t_num_sql = $t_sql;
$t_q = mysql_query($t_num_sql);
$num_pat_tasks = mysql_num_rows($t_q);
if($num_pat_tasks > 0){
?>
<div class="task_menu" id="pat_task_menu" style="float:right; margin-right:10px;">
<span id="pat_task_header" style="font-size:14px; font-weight:normal">Tasks(<?= $num_pat_tasks; ?>)</span>
<?php
$od_sql = $t_sql . " AND dt.due_date < CURDATE();";
$tod_sql = $t_sql . " AND dt.due_date = CURDATE();";
$tom_sql = $t_sql . " AND dt.due_date = DATE_ADD(CURDATE(), INTERVAL 1 DAY);";
$fut_sql = $t_sql . " AND dt.due_date > DATE_ADD(CURDATE(), INTERVAL 1 DAY);";
?>
<div class="task_list" id="pat_task_list" style="display:none;">
<?php
$od_q = mysql_query($od_sql);
if(mysql_num_rows($od_q)>0){
?>
<h4 id="pat_task_od_header" style="color:red" class="task_od_header">Overdue</h4>
<ul id="pat_task_od_list">
<?php
while($od_r = mysql_fetch_assoc($od_q)){
?><li class="task_item task_<?= $od_r['id']; ?>" style="clear:both;">
<div class="task_extra" id="task_extra_<?= $od_r['id']; ?>" >
  <a href="#" onclick="delete_task('<?= $od_r['id']; ?>')" class="task_delete"></a>
  <a href="#" onclick="loadPopup('add_task.php?id=<?= $od_r['id']; ?>')" class="task_edit">Edit</a>
</div>
<input type="checkbox" class="task_status" value="<?= $od_r['id']; ?>" />
<?php echo $od_r['task']; ?>
<?php if($od_r['firstname']!='' && $od_r['lastname']!=''){
  echo ' (<a href="add_patient.php?ed='.$od_r['patientid'].'&preview=1&addtopat=1&pid='.$od_r['patientid'].'">'.$od_r['firstname'].' '. $od_r['lastname'].'</a>)';
} ?>
</li>
<?php } ?>
</ul>
<?php } ?>


<?php
$od_q = mysql_query($tod_sql);
if(mysql_num_rows($od_q)>0){
?>
<h4 id="pat_task_tod_header" class="task_tod_header">Today</h4>
<ul id="pat_task_tod_list">
<?php
while($od_r = mysql_fetch_assoc($od_q)){
?><li class="task_item task_<?= $od_r['id']; ?>" style="clear:both;">
<div class="task_extra" id="task_extra_<?= $od_r['id']; ?>" >
  <a href="#" onclick="delete_task('<?= $od_r['id']; ?>')" class="task_delete"></a>
  <a href="#" onclick="loadPopup('add_task.php?id=<?= $od_r['id']; ?>')" class="task_edit">Edit</a>
</div>
<input type="checkbox" class="task_status" value="<?= $od_r['id']; ?>" />
<?php echo $od_r['task']; ?>
<?php if($od_r['firstname']!='' && $od_r['lastname']!=''){
  echo ' (<a href="add_patient.php?ed='.$od_r['patientid'].'&preview=1&addtopat=1&pid='.$od_r['patientid'].'">'.$od_r['firstname'].' '. $od_r['lastname'].'</a>)';
} ?>
</li>
<?php } ?>
</ul>
<?php } ?>


<?php
$od_q = mysql_query($tom_sql);
if(mysql_num_rows($od_q)>0){
?>
<h4 id="pat_task_tom_header" class="task_tom_header">Tomorrow</h4>
<ul id="pat_task_tom_list">
<?php
while($od_r = mysql_fetch_assoc($od_q)){
?><li class="task_item task_<?= $od_r['id']; ?>" style="clear:both;">
<div class="task_extra" id="task_extra_<?= $od_r['id']; ?>" >
  <a href="#" onclick="delete_task('<?= $od_r['id']; ?>')" class="task_delete"></a>
  <a href="#" onclick="loadPopup('add_task.php?id=<?= $od_r['id']; ?>')" class="task_edit">Edit</a>
</div>
<input type="checkbox" class="task_status" value="<?= $od_r['id']; ?>" />
<?php echo $od_r['task']; ?>
<?php if($od_r['firstname']!='' && $od_r['lastname']!=''){
  echo ' (<a href="add_patient.php?ed='.$od_r['patientid'].'&preview=1&addtopat=1&pid='.$od_r['patientid'].'">'.$od_r['firstname'].' '. $od_r['lastname'].'</a>)';
} ?>
</li>
<?php } ?>
</ul>
<?php } ?>

<?php
$od_q = mysql_query($fut_sql);
if(mysql_num_rows($od_q)>0){
?>
<h4 id="pat_task_fut_header" class="task_fut_header">Future</h4>
<ul id="pat_task_fut_list">
<?php
while($od_r = mysql_fetch_assoc($od_q)){
?><li class="task_item task_<?= $od_r['id']; ?>" style="clear:both;">
<div class="task_extra" id="task_extra_<?= $od_r['id']; ?>" >
  <a href="#" onclick="delete_task('<?= $od_r['id']; ?>')" class="task_delete"></a>
  <a href="#" onclick="loadPopup('add_task.php?id=<?= $od_r['id']; ?>')" class="task_edit">Edit</a>
</div>
<input type="checkbox" class="task_status" value="<?= $od_r['id']; ?>" />
<?php echo $od_r['task']; ?>
<?php if($od_r['firstname']!='' && $od_r['lastname']!=''){
  echo ' (<a href="add_patient.php?ed='.$od_r['patientid'].'&preview=1&addtopat=1&pid='.$od_r['patientid'].'">'.$od_r['firstname'].' '. $od_r['lastname'].'</a>)';
} ?>
</li>
<?php } ?>
</ul>
<?php } ?>



</div>
</div>
<?php
/*
$task_sql = "select dt.*, du.name, p.firstname, p.lastname from dental_task dt
        JOIN dental_users du ON dt.responsibleid=du.userid
        LEFT JOIN dental_patients p ON p.patientid=dt.patientid
   WHERE (dt.status = '0' OR
        dt.status IS NULL) AND
        (du.docid='".mysql_real_escape_string($_SESSION['docid'])."' OR du.userid='".mysql_real_escape_string($_SESSION['docid'])."')";
$task_q = mysql_query($task_sql." AND dt.due_date <= DATE_ADD(CURDATE(), INTERVAL 1 DAY);");
$num_tasks = mysql_num_rows($task_q);
?>
 <div id="task_menu" class="task_menu" style="margin-top:8px;float:right">
<span id="task_header">Tasks (<span id="task_count"><?= $num_tasks; ?></span>)</span>
<div id="task_list" style="border: solid 1px #000; position: absolute; z-index:20;background:#fff;padding:10px;display:none;">
<?php
$od_sql = $task_sql . " AND dt.due_date < CURDATE();";
$tod_sql = $task_sql . " AND dt.due_date = CURDATE();";
$tom_sql = $task_sql . " AND dt.due_date = DATE_ADD(CURDATE(), INTERVAL 1 DAY);";

$od_q = mysql_query($od_sql);
if(mysql_num_rows($od_q)>0){
?>
<h4 id="task_od_header" class="task_od_header">Overdue</h4>
<ul id="task_od_list">
<?php
while($od_r = mysql_fetch_assoc($od_q)){
?><li class="task_item task_<?= $od_r['id']; ?>" style="clear:both;">
<div class="task_extra" id="task_extra_<?= $od_r['id']; ?>" >
  <a href="#" onclick="delete_task('<?= $od_r['id']; ?>')" class="task_delete"></a>
  <a href="#" onclick="loadPopup('add_task.php?id=<?= $od_r['id']; ?>')" class="task_edit">Edit</a>
</div>
<input type="checkbox" class="task_status" value="<?= $od_r['id']; ?>" />
<?php echo $od_r['task']; ?>
<?php if($od_r['firstname']!='' && $od_r['lastname']!=''){
  echo ' (<a href="add_patient.php?ed='.$od_r['patientid'].'&preview=1&addtopat=1&pid='.$od_r['patientid'].'">'.$od_r['firstname'].' '. $od_r['lastname'].'</a>)';
} ?>
</li>

*/

}
?>









</div>
  <?php } 
?>

<div class="suckertreemenu">
<ul id="treemenu1" style="padding-top:3px;">
<li><a href="manage_patient.php">PATIENT</a>
  <ul>
              <li><a href="manage_patient.php">Manage Patients</a></li>
              <li><a href="#">Directory</a>
                  <ul>
                     <li><a href="manage_contact.php">Contacts</a></li>
                     <li><a href="manage_referredby.php">Referral List</a></li>
                     <li><a href="manage_sleeplab.php">Sleep Labs</a></li>
                     <li><a href="manage_fcontact.php">Corporate Contacts</a></li>
                   </ul>
              </li>
  </ul>
</li>
<li>
<a href="#">REPORTS</a>

  <ul>
     <li><a href="ledger_reportfull.php">Ledger</a></li>
     <li><a href="manage_claims.php">Claims (<?= $num_pending_claims; ?>)</a></li>
     <li><a href="performance.php">Performance</a></li>
     <li><a href="manage_screeners.php">Pt. Screener</a></li>
  </ul>
</li>

<?php
  $mess_count = $pending_letters + $num_preauth + $num_pc + $num_pi + $num_c;
  $mess_count = $pending_letters + $num_preauth + $num_rejected_preauth + $num_pc + $num_pi + $num_c + $num_bounce;
?>
<li><a href="#">MESSAGES (<?php echo $mess_count; ?>)</a>
  <ul>
      <li><a <?php {echo "href='letters.php?status=pending'";} ?>>Pending Letters (<?php echo $pending_letters; ?>)</a></li>
      <li><a <?php {echo "href='manage_vobs.php'";} ?>>VOBs (<?= $num_preauth; ?>)</a></li>
      <li><a <?php {echo "href='manage_patient_contacts.php'";} ?>>Patient Contacts (<?= $num_pc; ?>)</a></li>
      <li><a <?php {echo "href='manage_patient_insurance.php'";} ?>>Patient Insurance (<?= $num_pi; ?>)</a></li>
      <li><a <?php {echo "href='manage_patient_changes.php'";} ?>>Patient Changes (<?= $num_c; ?>)</a></li>
      <li><a href="manage_vobs.php?status=<?= DSS_PREAUTH_REJECTED; ?>&viewed=0">Alerts (<?= $num_rejected_preauth; ?>)</a></li>
      <li><a href="manage_email_bounces.php">Email Bounces (<?= $num_bounce; ?>)</a></li>
      <li><a href="manage_tasks.php">Tasks (<?= $num_tasks; ?>)</a></li>
  </ul>


  </ul>
</li>

</ul>
</div>
  <?php if(isset($_GET['pid']) && $_GET['pid']!=''){ ?>
    <div id="patient_nav">
      <ul>
        <li><a class="<?= ($_SERVER['PHP_SELF']=='/manage/manage_flowsheet3.php')?'nav_active':'';?>" <?php {echo "href='manage_flowsheet3.php?pid=".$_GET['pid']."&addtopat=1'";} ?>>Tracker</a></li>
        <li><a class="<?= ($_SERVER['PHP_SELF']=='/manage/dss_summ.php')?'nav_active':'';?>" <?php {echo "href='dss_summ.php?pid=".$_GET['pid']."&addtopat=1'";} ?>>Summary Sheet</a> </li>
        <li><a class="<?= ($_SERVER['PHP_SELF']=='/manage/manage_ledger.php')?'nav_active':'';?>" <?php {echo "href='manage_ledger.php?pid=".$_GET["pid"]."&addtopat=1'";} ?>>Ledger</a> </li>
        <li><a class="<?= ($_SERVER['PHP_SELF']=='/manage/manage_insurance.php')?'nav_active':'';?>" <?php { echo "href='manage_insurance.php?pid=".$_GET["pid"]."&addtopat=1'";} ?>>Insurance</a></li>
        <li><a class="<?= ($_SERVER['PHP_SELF']=='/manage/manage_progress_notes.php')?'nav_active':'';?>" <?php {echo "href='dss_summ.php?sect=notes&pid=".$_GET["pid"]."&addtopat=1'";} ?>>Progress Notes</a></li>
        <li><a class="<?= ($_SERVER['PHP_SELF']=='/manage/patient_letters.php')?'nav_active':'';?>" <?php {echo "href='dss_summ.php?sect=letters&pid=".$_GET['pid']."&addtopat=1'";} ?>>Letters</a></li>
        <li><a class="<?= ($_SERVER['PHP_SELF']=='/manage/q_image.php')?'nav_active':'';?>" href="q_image.php?pid=<?= $_GET['pid'] ?>">Images</a></li>
        <li><a class="<?= (strpos($_SERVER['PHP_SELF'],'q_page') || strpos($_SERVER['PHP_SELF'],'q_sleep'))?'nav_active':'';?>" href="q_page1.php?pid=<?= $_GET['pid'] ?>&addtopat=1">Questionnaire</a></li>
        <li><a class="<?= (strpos($_SERVER['PHP_SELF'],'ex_page'))?'nav_active':'';?>" href="ex_page4.php?pid=<?= $_GET['pid'] ?>&addtopat=1">Clinical Exam</a> </li>
        <li class="last"><a class="<?= ($_SERVER['PHP_SELF']=='/manage/add_patient.php')?'nav_active':'';?>" href="add_patient.php?ed=<?= $_GET['pid'] ?>&preview=1&addtopat=1&pid=<?= $_GET['pid'] ?>">Patient Info</a></li>
      </ul>


    </div>
  <?php }else{ ?>
    <div style="clear:both;"></div>
  <?php } ?>
</div>
<div style="clear:both;"></div>
</div>


<div style="background:url(images/dss_03.jpg) repeat-y top left #FFFFFF;" id="contentMain">

<div style="clear:both;"></div>
<?php if(isset($_GET['pid']) && $_GET['pid']!= ''){?> <div style="margin-left:20px;float:left;width:400px;display:none;"> <?php echo "You are currently in a patient chart - " ?><a href="manage_patient.php" target="_self" style="font-weight:bold;">BACK TO PATIENT LIST</a><?php ?> </div><div style="float:right;width:300px;"> 
                    <?php
                    $sql = "select * from dental_patients where docid='".$_SESSION['docid']."' AND patientid=".$_GET['pid'];
                    $my=mysql_query($sql) or die(mysql_error());
                    while($myarray = mysql_fetch_array($my))
		                {
                     $thename= $myarray['firstname']." ".$myarray['lastname'];
                    if($myarray["premedcheck"] == 1){
                    //echo "&nbsp;&nbsp;&nbsp;<font style=\"font-weight:bold; font-size:18px; color:#FF0000;\">*PREMED PATIENT</font>";
                    }
                    }
                    ?>
                    </div> <?php } ?>
<br />

<?php
  if(isset($_GET['pid'])){
	$s = "SELECT * FROM dental_patients WHERE parent_patientid='".mysql_real_escape_string($_GET['pid'])."'";
                                $q = mysql_query($s);
                                $n = mysql_num_rows($q);
				$n = num_patient_changes($_GET['pid']);
                                $pat = mysql_fetch_assoc($q);
$contacts_sql = "SELECT pc.id, pc.contacttype, pc.firstname, pc.lastname, pc.address1, pc.address2, pc.city, pc.state, pc.zip, pc.phone,
        p.firstname as patfirstname, p.lastname as patlastname
        FROM dental_patient_contacts pc 
        INNER JOIN dental_patients p ON pc.patientid=p.patientid
        WHERE p.docid='".$_SESSION['docid']."' AND
                p.patientid='".mysql_real_escape_string($_GET['pid'])."'";
$contacts_my = mysql_query($contacts_sql);
$total_contacts = mysql_num_rows($contacts_my);
$insurance_sql = "SELECT pi.*, p.firstname as patfirstname, p.lastname as patlastname FROM dental_patient_insurance pi INNER JOIN dental_patients p ON pi.patientid=p.patientid 
        WHERE p.docid='".$_SESSION['docid']."' AND
                p.patientid='".mysql_real_escape_string($_GET['pid'])."'";
$insurance_my = mysql_query($insurance_sql);
$total_insurance = mysql_num_rows($insurance_my);
                                if(($n+$total_contacts+$total_insurance)>0){ ?>
<a class="warning" href="patient_changes.php?pid=<?=$_GET['pid'];?>">
<span>Warning! Patient has updated their PROFILE via the online patient portal, and you have not yet accepted these changes. Please click this box to review patient changes.</span>
</a>

                                <? } 

        $exist_sql = "SELECT symptoms_status, treatments_status, history_status FROM dental_patients WHERE patientid='".mysql_real_escape_string($_GET['pid'])."'";
        $exist_q = mysql_query($exist_sql);
        $exist_row = mysql_fetch_assoc($exist_q);
	if($exist_row['symptoms_status']==2 || $exist_row['treatments_status']==2 || $exist_row['history_status']==2 || $exist_row['sleep_status']==2){ ?>
<a class="warning" href="q_page1.php?pid=<?= $_GET['pid']; ?>&addtopat=1" >
<span>Warning! Patient has updated their QUESTIONNAIRE via the online patient portal, and you have not yet accepted these changes. Please click this box to review patient changes.</span>
</a>
	<?php
	}


        $email_sql = "SELECT patientid FROM dental_patients WHERE email_bounce=1 AND patientid='".mysql_real_escape_string($_GET['pid'])."'";
        $email_q = mysql_query($email_sql);
        if(mysql_num_rows($email_q)>0){ ?>
<a class="warning" href="add_patient.php?ed=<?= $_GET['pid']; ?>&pid=<?= $_GET['pid']; ?>&addtopat=1" >
<span>Warning! Email sent to this patient has bounced. Please click to check patients email.</span>
</a>
        <?php
        }



  }

  $sql = "SELECT use_letters from dental_users WHERE userid='".mysql_real_escape_string($_SESSION['docid'])."'";
  $q = mysql_query($sql);
  $r = mysql_fetch_assoc($q);
  $use_letters = ($r['use_letters']=='1');

?>


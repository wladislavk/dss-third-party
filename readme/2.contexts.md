Contexts
========

Context classes are written in Behat. See Behat docs [here](http://docs.behat.org/en/latest/).

Context communication
---------------------

Unfortunately, Behat contexts are isolated and there is no native way to communicate
between them. This can present a problem if a scenario is stateful and different lines
of Gherkin are executed by different context classes. In provided examples you can
see one possible way of emulating inter-component communication. One of the context classes
is called "Main", and there is reference to it in the parent context. Whenever the client
needs to be called, it is not called from the current context class, but the reference
to main context is used. This way, it can be ensured that all HTTP calls are executed by the
same client instance.

Rolling back external changes
-----------------------------

In xUnit architecture, rolling back changes is easy - we can just call tearDown() from inside
the test class and be rest assured that it will execute no matter what. In Behat,
we also have something similar - "AfterScenario" hook, however, it works more tricky than
tearDown().

By definition, all scenarios in a suite share all contexts. Therefore, an AfterScenario hook
defined in a context class will not execute just for the scenario that the coder had in
mind - it will execute for every single scenario in the suite, which can bring a lot of
performance concerns. To prevent this behavior, it is recommended to use instance variables:
whenever a change happens, an instance variable on some context is set to true, and
AfterScenario method for that context checks if the instance variable is true.

Test volatility
---------------

Acceptance tests tend to be volatile because of different reasons such as internet connection,
server response time and many others. By volatility, it is meant that the same test can either
pass or fail at random. Here are ways to cope with high volatility:
    - check that AfterScenario hook executes properly
    - increase wait time after page load to make sure all JS is loaded (500 ms by default)
    - check that security measures for preventing brute-force attacks are disabled while in
      testing mode

However, it is impossible to completely defeat volatility, so the following rule is recommended:
run every test twice, if it passes only once, make three more attempts. If the test passes
at least once more, it should be considered "green". If there are less than two passes on five
attempts, the volatility is too high to ignore and it might point to a problem in the test code.

Naming convention
-----------------

Behat does not enforce any method naming convention, however it is recommended to
prepend all method names corresponding to "Then" clauses with "test", and use "event()"
naming for global hooks, e.g. "afterScenario()".

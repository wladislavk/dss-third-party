# 4.1.1. What must be tested in a unit test?

All classes sharing some business logic MUST be unit-tested, which means 'tested in isolation'.
Classes that are eligible for unit-testing MUST reside in separate namespaces.
Unit tests for these classes MUST be located at the same path and namespace relative to
tests root as where the classes under test are relative to production code root,
in other words, a class under `app/Foo/Bar.php` MUST have a unit test at `tests/Foo/BarTest.php`.

Testable classes MUST include all services and SHOULD NOT include controllers, factories,
wrappers, test cases, repositories and structs. Model classes MAY be unit-tested.

The general rule regarding the tests is that all conditionals SHOULD be unit-tested
with a notable exception of controller conditionals that return response immediately.
Therefore, non-unit-testable classes SHOULD NOT contain any other conditionals. There are
three types of conditionals in PHP: `if/elseif/else`, `switch/case/default` and 
`try/catch/finally`.

The number of test methods per each test class can be calculated precisely based on
these rules:

1) each conditional outside of cycle MUST have its own test method;
2) conditionals inside of cycle MAY be tested in a single method by creating collection
elements with different properties;
3) however, conditionals with `return` operators in their bodies MUST have their own
test methods even if inside cycles;
4) each `throw` operator MUST have its own test method, whether inside or outside of cycle;
5) if a conditional contains several conditions, it SHOULD be treated as if there are several
conditionals, so `if ($a && $b)` is the same as `if ($a) { if ($b) {}}`, geometrically increasing
the number of test methods;
6) every public method MUST be tested;
7) if a public method `a()` is called by another public method `b()` of same class, there MUST
be two tests, one for direct calling of `a()`, one for calling `a()` via `b()`.

Eloquent SHOULD be trusted, in other words, if an Eloquent model is expected to return
an object of certain type or an array with certain keys, it MAY NOT be tested
specifically for this type or the presence of these keys. However, the possibility of 
returning `null` or empty array MUST NOT be discarded while testing.

If a variable is changed, then passed to a method of another class, never to be used again, 
it SHOULD be saved somehow during the calling of that method, then its value asserted.

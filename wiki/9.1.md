# 9.1. Testing workflow

Acceptance testing solves three problems:
1) easy communication between development team and the management by clearly showing which features are 
   implemented and how  
2) testing borderline interactions that are hard to test otherwise, such as Ajax calls
3) testing code that is hard to test otherwise, such as spaghetti code

In this project, acceptance testing is implemented using Gherkin specification language, Behat, which implements
Gherkin for PHP, and Mink, that allows to run tests using different drivers. All acceptance tests are contained
within a separate repository and can only be run from within Docker container for security reasons.

New acceptance tests MUST be created for every new feature, bugfix, modification or refactoring of existing
feature, with the following exceptions:
1) the feature is completely technical and does not change user experience, i.e. moving some data to a new
   DB table or new algorithm for generation of reports
2) the feature changes user experience in a way that depends on subjective human perception so that false
   positives are likely, such as: CSS changes, animation, HTML changes for "tidying up" look and feel 
   of a webpage etc.
3) the feature changes user experience in a way that is hard to test because of technical limitations,
   such as parsing of `window` object by headless browsers.

New acceptance tests MUST be created for any large-scale migrations of the code, even if they do not lead
to changes in user experience.

There are two different types of workflow associated with acceptance tests: one for new features, the other
for refactoring existing features.

## Testing new features

Ideally, Gherkin feature files are created by someone outside the development team and given to the team as a
part of task description. However, if feature files are impossible to obtain for some reason, or feature files
were given but they contain errors that make them impossible to use, it is up to developers to create or modify
feature files and give them back to the management for approval. Once modified files are approved, contexts are
created, and after that work on the feature may begin. The new test MUST fail when the main repo is set to 
current master and MUST pass on a branch in the main repo where the work is done once PR is made.

## Testing existing features

If a feature is already working but untested, it SHOULD NOT be modified or refactored until acceptance tests 
are written. Currently working feature on master in this case should be perceived as the source of truth, so
there is no need for developers to approve new feature files with the management. The new test MUST pass both
on current master and on the issue branch.

In both cases, it is recommended to create acceptance tests before doing any other work. The branch with new
acceptance tests MUST link to the same Jira issue as the main branch and MUST be merged at the same time
as the main branch.
